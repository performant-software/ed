---
layout: default
---

<div class="row">
  <div class="col-md-6">
        <div class="page">
            <h2 class="page-title">{{ page.title }}</h2>
            {{ content }}
        </div>
  </div>
  <div class="col-md-6">
    <div id="annotation-well">
    <h4>Filter</h4>
    <select id="tag-filter" multiple="multiple">
        <option></option>
    </select>
    <select id="cat-filter" multiple="multiple">
        <option></option>
    </select>
    <select id="user-filter" multiple="multiple">
        <option></option>
    </select>
    <hr>
    <h4>View</h4>
    <div id="annotation-viewer">
    </div>
    </div><!--/well -->
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.1.0.slim.min.js" integrity="sha256-cRpWjoSOw5KcyIOaZNo4i6fZ9tKPhYYb6i5T9RSVJG8=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.15.0/lodash.core.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>
<script type="text/javascript">
  var annotations = $(".annotator-hl");
  var tf = $('#tag-filter').select2({
    data: filterLists['tags'],
    placeholder: "Select one or more tags",
    theme: "classic",
    width: "300px",
  });
  var cf = $('#cat-filter').select2({
    data: filterLists['annotation_categories'],
    placeholder: "Select one or more categories",
    theme: "classic",
    width: "300px",
  });
  var uf = $('#user-filter').select2({
    data: filterLists['user'],
    placeholder: "Select one or more annotators",
    theme: "classic",
    width: "300px",
  });
  tf.on("select2:select", function (e) { 
    annotations.attr("style", "background-color: #fff");
    $("span[data-tags~='" + e.params.data.id + "']").removeAttr("style");
    console.log(e.params.data.id);
  });
  tf.on('select2:unselect', function(e){
    annotations.removeAttr("style");
  });
  cf.on("select2:select", function (e) { 
    annotations.attr("style", "background-color: #fff");
    $("span[data-annotation_categories~='" + e.params.data.id + "']").removeAttr("style");
  });
  cf.on('select2:unselect', function(e){
    annotations.removeAttr("style");
  });
  uf.on("select2:select", function (e) { 
    annotations.attr("style", "background-color: #fff");
    $("span[data-user~='" + e.params.data.id + "']").removeAttr("style");
  });
  uf.on('select2:unselect', function(e){
    annotations.removeAttr("style");
  });

  annotations.click(function(a){
    var idtarget = a.target;

    $(".glyphicon-comment").remove();
    $(idtarget).prepend('<i class="glyphicon glyphicon-comment"></i>');

    var customTags = [ '[%', '%]' ];
    var anno = Object.assign({}, idtarget.dataset)

    anno.quote = $(idtarget).text()
    var template = $('#annotation-template').html();
    Mustache.parse(template, customTags);
    var rendered = Mustache.render(template, anno);
    $("#annotation-viewer").html(rendered);
  
  });

  // TODO: Implement Next/Previous Annotation Buttons.
  // TODO: Implement Next/Previous Viewport's-worth Buttons. (page breaks?)

</script>
<script type="text/template" id="annotation-template">
    <table id="annotation-table">
        <tr>
            <td class="anno-label">Quote:</td>
            <td><span id="quote[%uuid%]" class="sbquote details">&quot;[%quote%]&quot;</span></td>
        </tr>
        <tr>
            <td class="anno-label">Comment:</td>
            <td><span id="text[%uuid%]" class="sbtext details">[%&text%]</span></td>
        </tr>
        <tr>
            <td class="anno-label">Author:</td>
            <td><span id="info[%uuid%]" class="sbinfo details">[%username%]</span></td>
        </tr>
        <tr>
            <td class="anno-label">Tags:</td>
            <td><div id="tags[%uuid%]" class="sbtags details">[%#tags%]<span class="label label-default">[%.%]</span>[%/tags%]</div></td>
        </tr>
        <tr>
            <td class="anno-label">Categories:</td>
            <td><div id="categories[%uuid%]" class="sbcats details">[%#annotation_categories%]<span class="label label-default">[%.%]</span> [%/annotation_categories%]</div></td>
        </tr>
    </table>
</script>
